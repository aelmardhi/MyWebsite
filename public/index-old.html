<!DOCTYPE html>
<html lang="en">
    <head>
	<link rel="manifest" href="/manifest.json">
	<meta name="theme-color" content="#39f"/>
	<link rel="icon" href="favicon.ico" type="favicon.ico" />  
	<link rel="apple-touch-icon" href="icons/icon152.png">    
	<meta name="apple-mobile-web-app-capable" content="yes">  
	<meta name="apple-mobile-web-app-status-bar-style" content="#39f"> 
	<meta name="apple-mobile-web-app-title" content="Dardasha"> 
	<meta name="msapplication-TileImage" content="icons/icon144.png">  
	<meta name="msapplication-TileColor" content="#39f">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="utf-8">
	<meta name="description" content="This is aelmardhi's personal site, it is used to run small projects">
        <title>Home</title>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-V95FG9MK9N"></script>
        
    </head >
    <style>
        :root{
            --clr-primary:#e1ecfc;
            --clr-secondary: #39f;
            --clr-accent1: #06e;
            --clr-accent2: #5af;
            --clr-accent3: #06299c;
            --clr-accent4: #3af;
            --clr-light: #fff;
            --clr-body : #fff;
            --clr-danger: #cf1b24;
            --clr-main: #39f3;
            --border1 :  2px solid #39f9;
            --bs-main: 2px 2px 10px #0003, 10px 10px 20px  #39f5;
            --bs-article: none;
            --bs-downloads: inset 0 0 8px #0003 , inset 0 0 15px #0001;
            --bs-downloads-hover: 0 0 6px #0005, 0 0 12px #0003;
            --bs-games:inset 0 0 8px #0005 , inset 0 0 15px #0003;
            --lum: 60%;
        }
        .theme1{   
            --clr-primary: #861429;
            --clr-secondary: darkred;
            --clr-accent1: firebrick;
            --clr-accent2: #dc2323;
            --clr-accent3: palegoldenrod;
            --clr-accent4: brown;
            --clr-light: oldlace;
            --clr-body: #ff2a52;
            --clr-main: firebrick;
            --clr-danger: crimson;
            --border1: none;
            --bs-main: 0 0 10px 2px gold;
            --bs-article: none;
            --bs-downloads: inset 0 0 8px #0003 , inset 0 0 15px #0001;
            --bs-downloads-hover: 0 0 6px #0005, 0 0 12px #0003;
            --bs-games: inset 0 0 8px #0005 , inset 0 0 15px #0003;
            --lum: 60%;
            }
        @media(prefers-color-scheme: dark){ 
            :root{   
            --clr-primary:#232834;
            --clr-secondary: #126;
            --clr-accent1: #025;
            --clr-accent2: #128;
            --clr-accent3: #92b3ff;
            --clr-accent4: #126;
            --clr-light: #fff;
            --clr-body : #161009;
            --clr-main: #111320;
            --clr-danger: #8f0a10;
            --border1 :  none;
            --bs-main: inset 0 0 15px #5693, 0 0 10px #5696;
            --bs-article: none;
            --bs-downloads: inset 0 0 8px #0003 , inset 0 0 15px #0001;
            --bs-downloads-hover: 0 0 6px #0005, 0 0 12px #0003;
            --bs-games:inset 0 0 8px #0005 , inset 0 0 15px #0003;
            --lum: 10%;
            }
            .theme1{   
            --clr-primary: #320510;
            --clr-secondary: #640000;
            --clr-accent1: #460000;
            --clr-accent2: #3f1810;
            --clr-accent3: #ffbef7;
            --clr-accent4: #4f180f;
            --clr-light: oldlace;
            --clr-body : crimson;
            --clr-main: #86251420;
            --clr-danger: #9b2323;
            --border1 :  none;
            --bs-main:  0 0 15px #e881, 0 0 5px #9323;
            --bs-article: none;
            --bs-downloads: inset 0 0 8px #0003 , inset 0 0 15px #0001;
            --bs-downloads-hover: 0 0 6px #0005, 0 0 12px #0003;
            --bs-games:inset 0 0 8px #0005 , inset 0 0 15px #0003;
            --lum: 10%;
            }
        }
        *, *:after, *:before{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body{
            width: 100vw;
            height: 100vh;
            justify-content: center;
            align-items: center;
            display: flex;
            flex-direction: column;
            background-color: var(--clr-body);
            overflow-x: hidden;
            font-family: system-ui ,sans-serif;
        }
        main{
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            box-shadow: var(--bs-main);
            border-radius: 1em;
            /* background-color: var(--clr-main); */
            max-width: 1200px;
            max-height: calc(100vh - 4rem);
            width: 100%;
        }
        .main{
            border-left: none;
            border-radius: 0 1rem 0 0;
            width: 20%;
            min-width: 10rem;
        }
         article{
             margin: 0 auto;
             border-radius: 1em;
             overflow: hidden;
             text-align: center;
             box-shadow: var(--bs-article);
            border: var(--border1);
            display: flex;
            flex-direction: column;
            background-color: var(--clr-main);
            max-height: calc(100% - 3rem);
        }
        h2{
            text-align: center;
            color: var(--clr-accent2);
            font-size: 1rem;
        }
        .title{
            color: var(--clr-light);
            padding: 15px;
            font-size: 1.8rem;
            font-weight: bolder;
            background: var(--clr-secondary);
        }
        .error{
            background-color: var(--clr-danger);
            color: var(--clr-light);
            padding: 1em;
            box-shadow: var(--bs-downloads-hover);
            height: fit-content;
        }
        .data{
            width: 100%;
             background: var(--clr-primary);
             padding: 0 ;
            overflow-y: auto;
        }
        ul li{
            list-style: none;
        }
        li  {
            border-bottom: 1px solid var(--clr-accent2);
        }
        .main ul li a,
        .downloads ul li a,
        .games ul li a,
        .games h3{
            color: var(--clr-accent3);
            display: block;
           font-size: 1rem;
            padding: 10px 15px;
            width: 100%;
            letter-spacing: 1px;
            text-decoration: none;
            transition: all .3s ease;
        }
        .main ul li a:hover,
        .downloads ul li a:hover,
        .games ul li a:hover{
            background: var(--clr-accent4);
            color: var(--clr-light);
        }
    
        
        .downloads{
            border-radius: 0;
            flex: 1 1 0;
        }
        progress{
            width: 100%;
            accent-color: var(--clr-accent1);
        }
        .downloads .title{
            background: linear-gradient(90deg,var(--clr-accent1) 20%, var(--clr-accent2) 70%, var(--clr-secondary) 100%);
        }
        span {
            margin: 0;
            overflow: hidden;
            flex: 0 0 1;
            /* text-overflow: ellipsis; */
        }
        .downloads ul{
            overflow-y: auto;
            max-height: 80vh;
            height: 100%;
            padding: 15px;
            background: var(--clr-accent1);
            box-shadow: var(--bs-downloads);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px ,1fr));
			grid-auto-rows: max-content;
        }
        .downloads ul li {
            position: relative;
            margin: 5px;
            height: fit-content;
			border: none;
        }
        .downloads ul li a{
            display: flex;
            flex-direction: column;
            font-size: .8rem;
            padding: 0;
            background-color: var(--clr-light);
        }
        .downloads ul li a:hover{
            box-shadow: var(--bs-downloads-hover);
        }
        .downloads ul li a span{
            background: linear-gradient(45deg ,var(--clr-accent1) 50%, var(--clr-light) 70%);
            color: var(--clr-light);
            padding-left: 10px;;
            text-align: left;
        }
        
        .downloads ul li a:hover span{
            background: linear-gradient(45deg ,var(--clr-accent4) 50%, var(--clr-light) 70%);
        }
        .downloads ul li .download_link{
            position: absolute;
            border: none;
            font-size: .75rem;
            bottom: 5px;
            right: 1px;
            color: var(--clr-secondary);
            width: max-content;
            padding:  5px .5em;
            background-color: var(--clr-light);
        }
        .downloads ul li .download_link:hover{
            background-color: var(--clr-secondary);
            color: var(--clr-light);
        }
        .downloads ul li a span:nth-child(1){
            color: var(--clr-accent1);
            background: var(--clr-light);
                height: 50px;
                font-size: 1.1rem;
                display: flex;
                align-items: center;
                justify-content: start;
                font-weight: normal;
            }
        .downloads ul li a:hover span:nth-child(1){
            background-color: var(--clr-accent4);
            color: var(--clr-light);
        }
        
        .posts{
            --width: max( 25%, 14rem);
            width: var(--width);
            border-radius: 1em 0 0 0;
        }
        .posts .title{
            background: linear-gradient(90deg, var(--clr-secondary),var(--clr-accent1));
        }
        .posts ul{
            /* max-height: 70vh; */
            overflow-y: auto;
            height: 100%;
            background: var(--clr-primary);
            box-shadow: var(--bs-downloads);
            display: flex;
            flex-direction: column;
        }
        .posts li{
            background-color: var(--clr-primary);
            
            box-shadow: var(--bs-article);
        }
        .posts li + li{
            margin-top: .5em;
        }
        .posts a{
            text-decoration: none;
            color: unset;
        }
        .posts a:hover * {
            filter: hue-rotate(-20deg);
        }
        .posts .header img{
            margin-right: 1em;
            width: 2em;
            height: 2em;
            border-radius: 50%;
        }
        .posts .header{
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
            align-items: center;
            padding: .5em;
        }
        .posts .header div{
            display: flex;
            flex-direction: column;
            font-size: 1em;
            align-items: flex-start;
        }
        .posts .header h2{
            font-size: 1.2em;
            color: var(--clr-accent3);
        }
        .posts .header h3{
            font-size: .7em;
            color: var(--clr-accent2);
        }

        .posts li a> p, .posts li a> img{
            width: 100%;
            aspect-ratio: 1/1;
            background-color: var(--clr-accent1);
            color: var(--clr-light);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--bs-downloads);
        }
        .games{
            width: 100%;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            display: flex;
            flex-direction: row;
            min-height: calc(1.8rem + 20px);
        }
        
        .games h3{
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 200px;
            background: linear-gradient(90deg,var(--clr-accent1) 20%, var(--clr-accent4) 100%);
            color: var(--clr-light);
            font-size: 1.8rem;
            font-weight: 900;
        }
        .games_list{
            width: 100%;
            box-shadow: var(--bs-games);
            display: flex;
            flex-direction: row;
            overflow-y: hidden;
            overflow-x: auto;
            height: 100%;
        }
        .games_list li{
            display: flex;
            align-items: stretch;
            justify-content: center;
        }
        .games_list li a{
            display: flex;
            align-items: center;
            justify-content: center;
        }
        body > h2{
            margin: 1rem;
        }
        .mobile_nav{
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100vw;
            height: 3rem;
            display: none;
            flex-direction: row;
            align-items: stretch;
            justify-content: space-evenly;
            background-color: var(--clr-accent4);
        }
        .mobile_nav button{
            width: 100%;
            background: none;
            border: none;
            display: inline-flex;
        }
        .mobile_nav svg{
            height: 1.5rem;
            width: 1.5rem;
            margin: auto;
        }
        .mobile_nav svg path{
            fill: var(--clr-light);
        }
        .mobile_nav a:active svg path{
            opacity: .5;
        }
        .mobile_nav span{
            display: block;
            position: absolute;
            top: 0rem;
            left: 0;
            height: .25rem;
            width: 25vw;
            transform: translateX(0);
            background-color: var(--clr-light);
            transition: transform .2s ease ;
        }
        .active_link, .active_link:focus, .active_link:active, .active_link:hover{
            background: linear-gradient(60deg, var(--clr-main) 20%,  var(--clr-accent4) 50%,  var(--clr-main) 80%);
            background-repeat: repeat-x;
            animation: active_link_animation 1s ease 0s infinite ;
        }

        /*************************************************************/
        @media(max-width:600px){
            article, main, .main, .downloads, .games, .posts{
                
                width: 100vw;
                max-width: none;
                height: calc(100vh - 6rem);
                border-radius: 0;
                box-shadow: none;
                background-color: var(--clr-primary);
                max-height: unset;
            }
            main{
                width: 100vw;
                margin: 0em;
                flex-flow: row nowrap;
                overscroll-behavior-x: contain;
                scroll-snap-type: x mandatory;
                overflow-x: auto;
                scroll-behavior: smooth;
            }
            body{
                width: 100vw;
                display: block;
                overflow-x: auto;
            }
            html{
                width: 100vw;
                height: 100vh;
                overflow: hidden;
            }
            article{
                transition: transform .3s cubic-bezier(0.61, 0.22, 0.27, 0.8);
                flex-shrink: 0;
                scroll-snap-align: center;
            }
            ul, .games_list{
                overflow-y: auto;
                height: 100%;
            }
            ul li a{
                padding: 1rem;
                font-size: 1.2rem;
            }
            .title,.games h3{
                font-size: 2rem;
                padding: 15px;
                width: 100%;
                max-width: none;
            }
            /* .data{
            height: calc(100% - 2rem - 30px);
            } */
            .main{
                order: 1;
            }
            .downloads{
                order: 2;
                flex: 0 0 100%;
            }
            .games{
                order: 3;
            }
            .posts{
                order: 4;
            }
            .posts ul{
                max-height: none;
            }
            .posts li a{
                padding: 0;
            }
            .downloads .title{
                background: linear-gradient(90deg,var(--clr-accent1) 20%,  var(--clr-secondary) 70%);
            }
            .downloads ul{
                max-height: none;
                padding: 5px;

            }
            .downloads ul li .download_link{
                font-size: .6rem;
                padding: 5px 5px;
            }
            .downloads ul li a span{
                font-size: .7rem;
            }
            .downloads ul li a span:nth-child(1){
                font-size: .8rem;
            }
            .games, .games ul{
                box-shadow: none;
                flex-direction:column ;
            }
            .games h3{
                background: linear-gradient(90deg,var(--clr-accent4) 20%, var(--clr-accent1) 100%);
            }
	    body > h2{
                position: fixed;
                left: 0;
                bottom:3rem ;
                width: 100%;
                height: 3rem;
                font-size:1rem ;
                padding:.8rem ;
                margin:0rem ;
                background: var(--clr-accent4) ;
                color: var(--clr-light) ;

            }
            .mobile_nav{
                display: flex;
            }
        }
@keyframes active_link_animation {
    0%{
        background-position-x: 0em;
    }
    100%{
        background-position-x: 100em;
    }
}
        
    </style>
    <body>
        <main>
        <article class="posts" id="posts" data-MO="3">
            <div class="title">Blog</div>
            <div class="data">
                <ul id="posts-list"><progress></progress></ul>
            </div>
        </article>
        <article class="downloads" id="downloads" data-MO="1">
            <div class="title">Downloads</div>
            <div class="data">
                <ul id="downloads-list"><progress></progress></ul>
            </div>
        </article>
        <article id="main" class="main" data-MO="0">
            <div class="title">Main Routes</div>
            <div class="data">
                <ul>
                    <li><a href="index.html" style="font-weight: bold; font-style: italic; font-size: 1.2em;">Try the new design</a></li>
                    <li><a href="aelmardhi/">About Me</a></li>
                    <li><a href="/blog">Blog</a></li>
                    <li><a href="download.html">Http Downloader</a></li>
                    <li><a href="upload.html">File Uploader</a></li>
                    <li><a href="ytdl/">Youtube Downloader</a></li>
                    <li><a href="feed/index-old.html">Feed</a></li>
                    <li><a href="prayers/">Prayers time</a></li>
                    <li><a href="screenRecorder/">Screen Recorder</a></li>
                    <li><a href="share/">Share Files</a></li>
                    <li><a href="api/rtc/">videoChat</a>
                    </li><li><a href="dithering/">Dithering Demo</a></li>
                    <li><a href="filter/">Filter Demo</a></li>
                    <li><a href="jpeg/">JPEG</a></li>
                    <li><a href="qualculator/">Qualculator</a></li>                    </ul>
            </div>
        </article>
        <article id="games" class="games" data-MO="2">
            <h3>Games</h3>
            <ul class="games_list data">
                <!--<li><a href="games/brick-breaker/">Brick Breaker</a></li> -->
                <li><a href="games/candy_crush/">Candy Crush</a></li>
                <li><a href="games/connect_four/">Connect Four</a></li>
                <li><a href="games/frogger/">Frogger</a></li>
                <li><a href="games/words/">Words</a></li>
                <li><a href="games/globe/">Globe</a></li>
                <li><a href="games/memory_game/">Memory Game</a></li>
                <li><a href="games/snake/">Snake</a></li>
                <li><a href="games/space-invader/">Space Invader</a></li>
                <li><a href="games/stack/">Stack</a></li>
                <li><a href="games/tetris/">Tetris</a></li>
                <li><a href="games/whack-a-mole/">Whack a Mole</a></li>
            </ul>
        </article>
        
    </main>
        
        <h2>aelmardhi Â© 2022</h2>
        <div id="mobileNav" class="mobile_nav">
            <span></span>
            <button aria-label="show main routes button" style="background:var(--clr-accent3)" data-a="main"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M575.8 255.5C575.8 273.5 560.8 287.6 543.8 287.6H511.8L512.5 447.7C512.5 450.5 512.3 453.1 512 455.8V472C512 494.1 494.1 512 472 512H456C454.9 512 453.8 511.1 452.7 511.9C451.3 511.1 449.9 512 448.5 512H392C369.9 512 352 494.1 352 472V384C352 366.3 337.7 352 320 352H256C238.3 352 224 366.3 224 384V472C224 494.1 206.1 512 184 512H128.1C126.6 512 125.1 511.9 123.6 511.8C122.4 511.9 121.2 512 120 512H104C81.91 512 64 494.1 64 472V360C64 359.1 64.03 358.1 64.09 357.2V287.6H32.05C14.02 287.6 0 273.5 0 255.5C0 246.5 3.004 238.5 10.01 231.5L266.4 8.016C273.4 1.002 281.4 0 288.4 0C295.4 0 303.4 2.004 309.5 7.014L564.8 231.5C572.8 238.5 576.9 246.5 575.8 255.5L575.8 255.5z"/></svg></button>
            <button aria-label="show downloads button" data-a="downloads"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M144 480C64.47 480 0 415.5 0 336C0 273.2 40.17 219.8 96.2 200.1C96.07 197.4 96 194.7 96 192C96 103.6 167.6 32 256 32C315.3 32 367 64.25 394.7 112.2C409.9 101.1 428.3 96 448 96C501 96 544 138.1 544 192C544 204.2 541.7 215.8 537.6 226.6C596 238.4 640 290.1 640 352C640 422.7 582.7 480 512 480H144zM303 392.1C312.4 402.3 327.6 402.3 336.1 392.1L416.1 312.1C426.3 303.6 426.3 288.4 416.1 279C407.6 269.7 392.4 269.7 383 279L344 318.1V184C344 170.7 333.3 160 320 160C306.7 160 296 170.7 296 184V318.1L256.1 279C247.6 269.7 232.4 269.7 223 279C213.7 288.4 213.7 303.6 223 312.1L303 392.1z"/></svg></button>
            <button aria-label="show games button" data-a="games"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M448 64H192C85.96 64 0 149.1 0 256s85.96 192 192 192h256c106 0 192-85.96 192-192S554 64 448 64zM247.1 280h-32v32c0 13.2-10.78 24-23.98 24c-13.2 0-24.02-10.8-24.02-24v-32L136 279.1C122.8 279.1 111.1 269.2 111.1 256c0-13.2 10.85-24.01 24.05-24.01L167.1 232v-32c0-13.2 10.82-24 24.02-24c13.2 0 23.98 10.8 23.98 24v32h32c13.2 0 24.02 10.8 24.02 24C271.1 269.2 261.2 280 247.1 280zM431.1 344c-22.12 0-39.1-17.87-39.1-39.1s17.87-40 39.1-40s39.1 17.88 39.1 40S454.1 344 431.1 344zM495.1 248c-22.12 0-39.1-17.87-39.1-39.1s17.87-40 39.1-40c22.12 0 39.1 17.88 39.1 40S518.1 248 495.1 248z"/></svg></button>
            <button aria-label="show blog button" data-a="posts"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M384 32C419.3 32 448 60.65 448 96V416C448 451.3 419.3 480 384 480H64C28.65 480 0 451.3 0 416V96C0 60.65 28.65 32 64 32H384zM325.8 139.7C310.1 124.1 284.8 124.1 269.2 139.7L247.8 161.1L318.7 232.1L340.1 210.7C355.8 195 355.8 169.7 340.1 154.1L325.8 139.7zM111.5 303.8L96.48 363.1C95.11 369.4 96.71 375.2 100.7 379.2C104.7 383.1 110.4 384.7 115.9 383.4L176 368.3C181.6 366.9 186.8 364 190.9 359.9L296.1 254.7L225.1 183.8L119.9 288.1C115.8 293.1 112.9 298.2 111.5 303.8z"/></svg></button>
            </div>
    </body>
    <script>
        ////View ////////////////////////////////////////////////////
        document.addEventListener('DOMContentLoaded',function(){
            function randombetween(a,b){
                return Math.floor(a + Math.random()*(b-a));
            }
            document.body.style.background = `linear-gradient(45deg, hsla(${randombetween(0,255)},30%,var(--lum),.6), hsla(${randombetween(0,255)},20%,var(--lum),.6)), linear-gradient(-45deg, hsla(${randombetween(0,255)},50%,var(--lum),.6), hsla(${randombetween(0,255)},20%,var(--lum),.6)), linear-gradient(0deg, hsla(${randombetween(0,255)},20%,var(--lum),.6), hsla(${randombetween(0,255)},20%,var(--lum),.6))`
            //const themes = ['','theme1']
            const random = Math.floor(2*Math.random())
            if(random<.5)document.body.classList.add('theme1');
            ////LOAD DATA////////////////////////////////////////////////////
             const downloadsList = document.getElementById('downloads-list');
            const postsList = document.getElementById('posts-list');
            const downloads = document.getElementById('downloads');
            fetch('/api/download/files').then(r => r.json()).then(res => {
                    
                downloadsList.innerHTML = res.map(i =>{ 
                        let t = i.modified;
                        let s = (i.size > 1024)?((i.size > 1024 * 1024)? (i.size / 1024 /1024).toFixed(2) + ' MB' : (i.size / 1024).toFixed(2) + ' KB') : i.size + ' B'   ;
                        
                        return'<li><a href="./downloads/'+encodeURI(i.name)+'"><span>'+i.name+'</span><span>'+t+'</span><span>'+s+'</span></a><a  class="download_link" href="./downloads/'+encodeURI(i.name)+'" download="'+encodeURI(i.name)+'">DOWNLOAD</a></li>'}).join('');
                 }).catch(err =>{ 
                    downloadsList.innerHTML = '<h2 class="error">Sorry, Cannot Connect</h2>' 
                    console.log('fetch'+err+err.data)
                });
            
            fetch('/api/blog').then(r => r.json()).then(res => {
                
                postsList.innerHTML = res.map(p =>{ 
                     return `<li><a href="/blog/post/${p.id}">
                        <div class="header">
                            <img src="${p.author.profileImage}"></img>
                            <div>
                                <h2>${p.title}</h2>
                                <h3>${p.author.name} | ${p.project} | ${new Date(p.time).toISOString().substr(0,10)} </h3>
                            </div>
                        </div>
                        ${p.blocks[0].type === 'paragraph'? '<p>'+p.blocks[0].data.text+ '</p>'
                            : p.blocks[0].type === 'image' ?  '<img src="'+p.blocks[0].data.file.url+'"></img>'
                            : '</br>'}
                        </a></li>`  
                    }).join(''); 
                        }).catch(err =>{ 
                    postsList.innerHTML = '<h2 class="error">Sorry, Cannot Connect</h2>' 
                    console.log('fetch'+err+err.data)
                });
        })
////SERVER WORKER////////////////////////////////////////*/////////////////

	window.onload = () => {
 	 'use strict';

	  if ('serviceWorker' in navigator) {
	    navigator.serviceWorker.register('./worker.js');
        // Register a Service Worker.


navigator.serviceWorker.ready
.then(function(registration) {
  // Use the PushManager to get the user's subscription to the push service.
  return registration.pushManager.getSubscription()
  .then(async function(subscription) {
    // If a subscription was found, return it.
    if (subscription) {
      return subscription;
    }

    // Get the server's public key
    const response = await fetch('./vapidPublicKey');
    const vapidPublicKey = await response.text();
    // Chrome doesn't accept the base64-encoded (string) vapidPublicKey yet
    // urlBase64ToUint8Array() is defined in /tools.js
    const convertedVapidKey = vapidPublicKey;

    // Otherwise, subscribe the user (userVisibleOnly allows to specify that we don't plan to
    // send notifications that don't have a visible effect for the user).
    return registration.pushManager.subscribe({
      userVisibleOnly: true,
      applicationServerKey: convertedVapidKey
    });
  });
}).then(function(subscription) {
  // Send the subscription details to the server using the Fetch API.
  fetch('./register', {
    method: 'post',
    headers: {
      'Content-type': 'application/json'
    },
    body: JSON.stringify({
      subscription: subscription
    }),
  });

    

});
 	 }
	}

////////NAVIGATION////////////////////////////////////////////////////
    
    const main = document.querySelector('main');

    let articles = document.getElementsByTagName('article');
    let btns = document.querySelectorAll('.mobile_nav button');
    let mobileNavSpan = document.querySelector('.mobile_nav span');

    // if(!location.hash){
    //     main.scrollTo(main.scrollWidth * 2 /4,0)
    // }else{
    //     // history.back()
        
    // }
    
    btns.forEach(b=>{
        b.addEventListener('click',(e)=>{
            const a = e.currentTarget.getAttribute('data-a');
            document.getElementById(a).scrollIntoView();
            const toLocation = new URL(location);
            toLocation.hash = '#'+a;
            location.replace(toLocation)
        });
    });

    let observer = new IntersectionObserver((entries)=>{
        for(let e=0;e<articles.length;e++){
            btns.item(e).style.background = 'none'
        }
        entries.forEach(entry => {
            if(entry.isIntersecting ){
                btns.item(entry.target.getAttribute('data-MO')).style.background = 'var(--clr-accent3)'
                mobileNavSpan.style.transform = 'translateX('+ 100*(entry.target.getAttribute('data-MO'))+ '%) scaleX(1) '
                const toLocation = new URL(location);
                const a = entry.target.id
                toLocation.hash = '#'+a;
                location.replace(toLocation)
            }
        });
    },{
        root: document.body,
        rootMargin: '0px',
        threshold: 1.0
        }) 
    for(let e=0;e<articles.length;e++){
        articles.item(e).index = e;
        observer.observe(articles.item(e));
    }

////////LINKS ///////////////////////////////////////////////////////////
    let links = document.querySelectorAll('ul li a')
    links.forEach(l=> l.addEventListener('click',
    function linkKlick(e){
        
        for(let l of links){
            l.classList.remove('active_link')
        }
        e.target.classList.add('active_link')
    }))
    window.addEventListener('pagehide',()=>{
        for(let l of links){
            l.classList.remove('active_link')
        }
    })
    </script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
      
        gtag('config', 'G-V95FG9MK9N');
//eruda is dev tools for mobile
	    ;(function () {
    var src = '//cdn.jsdelivr.net/npm/eruda';
    if (!/eruda=true/.test(window.location) && localStorage.getItem('active-eruda') != 'true') return;
    document.write('<scr' + 'ipt src="' + src + '"></scr' + 'ipt>');
    document.write('<scr' + 'ipt>eruda.init();</scr' + 'ipt>');
})();
      </script>
</html>
